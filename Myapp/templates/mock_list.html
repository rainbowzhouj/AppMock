<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>项目详情页</title>
{#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">#}
    <link rel="stylesheet" href="/static/lightbox/node_modules/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/lightbox/node_modules/prismjs/themes/prism-tomorrow.css"/>
    <link rel="shortcut icon" href="/static/bitbug_favicon.ico">

    <style>
        th{ text-align: center}
        td{ text-align: center}
    </style>
</head>
<body>
{% include 'menu.html' %}
<table class="table table-bordered table-condensed table-striped" style="width: 80%;margin-left: 10%;">
    <thead style="background-color: #2d2f2f;color: white">
        <tr>
            <th>mock单元标题</th>
            <th>状态</th>
            <th style="min-width: 200px;">操作</th>
        </tr>
    </thead>
    <tbody>
        {% for i in mocks %}
            <tr>
                <td style="max-width: 500px;white-space:nowrap;overflow-x:auto;">
                    {{ i.name }}
                </td>
                <td id="state_{{ i.id }}">
                    {{ i.state }}
                </td>
                <td>
{#                    <a href="/mock_on/?mock_id={{ i.id}}">启用</a>#}
                    <a href="/mock_on/{{ i.id}}/">启用</a>
                    <a href="/mock_off/{{ i.id}}/">弃用</a>
                    <a href="javascript:mock_set({{ i.id}})">设置</a>
                    <a href="javascript:del_mock({{ i.id }})">删除</a>
{#                    <a href="/del_mock/{{ i.id }}/">删除</a>#}
                </td>

            </tr>
            <script>
                color_state=document.getElementById('state_{{ i.id }}')
                if('{{ i.state }}'=='True'){
                    color_state.style.color='green'
                }else{
                    color_state.style.color='red'
                }
            </script>
            {% empty %}
            <div style="line-height:50px;height:50px;background-color:wheat;position: absolute;top:300px ;width: 100%;text-align: center"><strong>没有内容</strong></div>
        {% endfor %}
    </tbody>
</table>
<script>
    function del_mock(mock_id) {
        $.showConfirm({
            title: "请确认删除", body: "你确定删除吗?", textTrue: "确定", textFalse: "取消",
            onSubmit: function (result) {
                if (result) {
                    $.get('/del_mock/'+mock_id+'/',{},function (ret) {
                        document.location.reload()
                    })
                } else {
                }
            },
        })
    }
</script>


{# lightbox #}
<script src="/static/lightbox/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/lightbox/js/bootstrap-show-modal.js"></script>
<script src="/static/lightbox/node_modules/prismjs/prism.js"></script>
<script>
    function project_set(){
         $.showModal({
            title: '请设置项目',
            body:
                '<form><div class="form-group row">' +
                '<div class="col-3"><label for="text" class="col-form-label">项目名称</label></div>' +
                '<div class="col-9"><input type="text" class="form-control" id="project_name_input"/></div>' +
                '</div>' +
                '</form>',
            footer: '<button type="button" class="btn btn-link" data-dismiss="modal">取消</button><button type="submit" class="btn btn-primary">保存</button>',
            onCreate: function (modal) {
                // create event handler for form submit and handle values
                $(modal.element).on("click", "button[type='submit']", function (event) {
                    event.preventDefault()
                    var $form = $(modal.element).find("form")

                    // 发送请求给后端
                    $.get('/save_project/',{
                        "new_name":$form.find("#project_name_input").val(),
                        "project_id":'{{ project_id }}'
                    },function (ret){
                        modal.hide()
                        document.location.reload()
                    })
                })
            }
        })
    }
    function mock_set(mock_id){
        $.get('/get_mock/',{
            'mock_id':mock_id
        },function (ret){
            $.showModal({
                title: '请设置mock单元',
                body:
                '<form>' +
                '<div class="form-group row">' +
                '<div class="col-3"><label for="text" class="col-form-label">mock名称</label></div>' +
                '<div class="col-9"><input type="text" class="form-control" value="'+ret.mock.name+'" id="mock_name"/></div>' +
                '</div>' +
                '<div class="form-group row">' +
                '<div class="col-3"><label for="text" class="col-form-label">url关键字</label></div>' +
                '<div class="col-9"><input type="text" class="form-control" value="'+ret.mock.catch_url+'" id="catch_url" placeholder="写url内关键字"/></div>' +
                '</div>'+
                '<div class="form-group row">' +
                '<div class="col-3"><label for="text" class="col-form-label">返回头</label></div>' +
                '<div class="col-9"><textarea  id="response_headers" class="form-control" rows="3" placeholder=r"必须是json格式如：{"a"：1，"b":"bb"}">'+ret.mock.response_headers+'</textarea></div>' +
                '</div>'+
                '<div class="form-group row">' +
                '<div class="col-3"><label for="text" class="col-form-label">模式选择</label></div>' +
                '<div class="col-9"><select  class="form-control" name="" id="model"><option value="Interceptor" >拦截模式</option><option value="Release">放行模式</option></select></div>' +
                '</div>' +
                '<div class="form-group row" id="display_fx_0">' +
                '<div class="col-3"><label for="text" class="col-form-label">返回值更新策略</label></div>' +
                '<div class="col-9"><textarea id="mock_response_body" rows="3" class="form-control"  placeholder="每行一个规则，具体规则如下:' +
                    '字符串替换使用=>,json替换使用=">'+ret.mock.mock_response_body+'</textarea></div>' +
                '</div>'+
                '<div class="form-group row" id="display_lj_0">' +
                '<div class="col-3"><label for="text" class="col-form-label">http状态码</label></div>' +
                '<div class="col-9"><input type="text" class="form-control" value="'+ret.mock.state_code+'" id="state_code" placeholder="必须写整形且存在的http状态码" /></div>' +
                '</div>' +
                '<div class="form-group row" id="display_lj_1">' +
                '<div class="col-3"><label for="text" class="col-form-label">返回体写死</label></div>' +
                '<div class="col-9"><textarea id="mock_response_body_lj" class="form-control" rows="3" placeholder="写死的返回值" >'+ret.mock.mock_response_body_lj+' </textarea></div>' +
                '</div>'+
                '</form>',
            footer: '<button type="button" class="btn btn-link" data-dismiss="modal">取消</button><button type="submit" class="btn btn-primary">保存</button>',
            onCreate: function (modal) {
                // create event handler for form submit and handle values
                $(modal.element).on("click", "button[type='submit']", function (event) {
                    event.preventDefault()
                    var $form = $(modal.element).find("form")
                    // 发送请求给后端
                    $.get('/save_mock/',{
                        "mock_id":mock_id,
                        "mock_name":$form.find("#mock_name").val(),
                        "catch_url":$form.find("#catch_url").val(),
                        "model":$form.find("#model").val(),
                        "response_headers":$form.find("#response_headers").val(),
                        "state_code":$form.find("#state_code").val(),
                        "mock_response_body_lj":$form.find("#mock_response_body_lj").val(),
                        "mock_response_body":$form.find("#mock_response_body").val(),
                    },function (ret){
                        modal.hide()
                        document.location.reload()
                    })
                })
            }
        })
            document.getElementById('model').value=ret.mock.model;
            //负责控制输入的显示和隐藏
            function change_model(model){

            }
            //打开弹窗时默认调用
            change_model(ret.mock.model)
            //当select模式选择变更后，调用
            $("#model").change(function (){
                change_model(document.getElementById('model').value)
            })
         })
    }
</script>


</body>
</html>